const _GobetServer="http://192.168.100.111:3000",_eLogServer=["localhost/log/","localhost/log2/"];var LD,auth="",session="",timerID=0,COOKIES={};function entryGame(e){clearInterval(timerID);var t=document.getElementById("panel");t.style.display="none",(t=document.getElementById("gameMainDiv")).style.display="block";btoa("/?infoUrl=h5/c46342&username=97905356u335&accessToken=e69f4bc92415f90ef6d8a8c43d660db8&language=in_id&exiturl=/gobet/&externalurl=/gobet/&dgt=");mo.PROJ.search=atob(session)+e;var n=document.getElementById("body");n&&n.style&&(n.style.display="block");var o=document.getElementById("loadingUi");o&&o.style&&(o.style.display="block"),LD.setCheckRotationDisabled(!1),egret.runEgret({renderMode:"webgl",audioType:0});var i=document.getElementById("gameMainDiv");for(let e in i.childNodes)"CANVAS"==i.childNodes[e].nodeName&&i.childNodes[e].addEventListener("webglcontextlost",(function(e){alert("Browser webGL crash. Refresh page now."),window.location.reload()}));return!1}function getCookie(e){var t=COOKIES[e];return t||""}function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var i="expires="+o.toUTCString(),a=e+"="+encodeURIComponent(t)+"; "+i+"; path=/";document.cookie=a}function req(e,t,n,o,i,a){var r=new XMLHttpRequest;if(r.onreadystatechange=function(){4==this.readyState&&200==this.status&&i&&i(r.responseText)},r.onerror=a,r.open(e,t,!0),o)for(var l in o)r.setRequestHeader(l,o[l]);r.send(n)}function updateInfo(e){var t=document.getElementById("balance");if(t){var n=e.nick,o=e.balance,i=Number(o).toLocaleString(navigator.language);t.innerHTML=i,(t=document.getElementById("nick")).innerHTML=n}}function startGame(e){if(""==auth){var t=document.getElementById("gameForm");return t.style.display="none",(t=document.getElementById("loginForm")).style.display="block",(t=document.getElementById("loginSlider")).value=1,!1}return entryGame(e)}function resetAction(){var e=this;if(e.value>70&&""==(e=document.getElementById("resetEmail")).value.trim())return e.className="error",void e.focus()}function registerAction(){var e=this;if(e.value>70){if(""==(e=document.getElementById("regUser")).value.trim())return e.className="error",void e.focus();if(""==(e=document.getElementById("regEmail")).value.trim())return e.className="error",void e.focus()}}function _updatePlayerInfo(e,t){var n=document.cookie,o={};o["Set-Cookie"]=n,req("GET",_GobetServer+"/auth",null,o,(function(n){var o=JSON.parse(n),i=o.nick;i&&""==i?(setCookie("auth","",6),auth="",session="",t&&t()):(setCookie("auth",i,6),auth=i,session=o.session,updateInfo(o),e&&e())}),(function(e){var t=document.getElementById("hint");t.innerHTML="Failed to login. Please try again later.",t.className="failed",setTimeout((function(){resetLoginAction()}),3e3)}))}function updatePlayerInfo(){""!=auth&&(""!=getCookie("token")&&""!=getCookie("login")&&""!=getCookie("nonce")&&_updatePlayerInfo())}function resetLoginAction(){var e=document.getElementById("loginSlider");e.value=0,e.addEventListener("change",loginAction),e.disabled=!1;var t=document.getElementById("hint");t.innerHTML="slide to login",t.className="hint"}function loginAction(){var e=this;if(e.value>70){e.disabled=!0,e.removeEventListener("change",loginAction);var t=document.getElementById("loginUser"),n=t.value.trim();if(""==n)return t.className="error",void t.focus();t.className="";var o=(t=document.getElementById("loginPasswd")).value.trim();if(""==o)return t.className="error",void t.focus();t.className="";var i=(new Date).getTime()+"",a=md5(o)+"",r=md5(a+n)+"",l=md5(r+i);return setCookie("nonce","",7),setCookie("login","",7),setCookie("token","",7),setCookie("nonce",i,7),setCookie("login",n,7),setCookie("token",l,7),void _updatePlayerInfo((function(){resetLoginAction(),updateState()}),(function(){var e=document.getElementById("hint");e.innerHTML="Failed to login, invalid user name or password. Please try again.",e.className="failed",setTimeout((function(){resetLoginAction()}),3e3)}))}}function logout(){return setCookie("auth","",6),auth="",updateState(),!1}function showRegistration(){var e=document.getElementById("loginForm");e.style.display="none",(e=document.getElementById("resetForm")).style.display="none",(e=document.getElementById("gameForm")).style.display="none",(e=document.getElementById("registerForm")).style.display="block"}function showResetForm(){var e=document.getElementById("loginForm");e.style.display="none",(e=document.getElementById("registerForm")).style.display="none",(e=document.getElementById("gameForm")).style.display="none",(e=document.getElementById("resetForm")).style.display="block"}function updateState(){var e=document.getElementById("exit");e.style.display="none",(e=document.getElementById("info")).style.display="none",(e=document.getElementById("loginForm")).style.display="none",(e=document.getElementById("registerForm")).style.display="none",(e=document.getElementById("resetForm")).style.display="none",(e=document.getElementById("gameForm")).style.display="block",""==auth?resetLoginAction():((e=document.getElementById("exit")).style.display="block",(e=document.getElementById("info")).style.display="block")}!function(e){function t(){o.scrollTo(0,1),o.platform="egret",0,n(),o.onorientationchange=n,setInterval((function(){n()}),1e3)}function n(){var t=document.getElementById("rotate_screen");if(t){if(e.checkRotationDisabled||i)return void(t.style.display="none");var n=document.getElementById("rotate_screen_img");n&&(n.style.width="100%"),t.style.display=e.isLandscape?window.innerHeight>window.innerWidth?"block":"none":window.innerHeight>window.innerWidth?"none":"block"}}var o=window,i=!1;e.setIsLandscape=function(t){e.isLandscape=t,n()},e.setCheckRotationDisabled=function(t){e.checkRotationDisabled=t,n()},e.load=t,e.stop=function(){clearInterval(undefined);var t=document.getElementById("loadingUi");if(t){t.innerHTML="",t.parentNode&&t.parentNode.removeChild(t);var n=document.getElementsByTagName("body")[0];e.delBg?setTimeout((function(){n.className=(n.className||"").replace(/body-bg/gi,"")}),100):e.bgImg&&(n.style["background-image"]='url("'+e.bgImg+'")')}},e.isPad=function(){var e=navigator.userAgent.toString().toLowerCase();return e.indexOf("ipad")>=0||e.indexOf("tablet")>=0},e.checkRotation=n,e.setPortraitMode=function(e){i=e,n()},t()}(LD||(LD={})),window.onload=function(){window.loadingStartTime=Date.now(),LD.delBg=!1,LD.setIsLandscape(!0);for(var e=decodeURIComponent(document.cookie).split(";"),t=0;t<e.length;t++){var n=e[t].trim().split("=");COOKIES[n[0]]=n[1]}auth=getCookie("auth"),updatePlayerInfo(),timerID=setInterval(updatePlayerInfo,5e3);var o=document.getElementById("registerSlider");if(o.addEventListener("change",registerAction),(o=document.getElementById("resetSlider")).addEventListener("change",resetAction),updateState(),"undefined"!=typeof mo){mo.PROJ.appInfo.cfgUrl="project.json",mo.PROJ.e_log_disabled=!0,mo.PROJ.e_log_server=_eLogServer,mo.PROJ.e_log_server_https=_eLogServer,mo.PROJ.search="";const e=document.createElement("a");e.href=_GobetServer,mo.PROJ.e_port=e.port,mo.PROJ.e_host=e.hostname}};
